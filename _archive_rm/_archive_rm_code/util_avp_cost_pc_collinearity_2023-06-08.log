NOTE: PROCEDURE PRINTTO used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
      

1981  ODS PDF FILE     = "&pdf" STARTPAGE = no;
NOTE: Writing ODS PDF output to DISK destination 
      "S:\FHPC\DATA\HCPF_Data_files_SECURE\Kim\isp\isp_utilization\reports\util_avp_cost
      _pc_collinearity_2023-06-08.pdf", printer "PDF".
1982  
1983  Title &file;
1984  
1985  proc odstext;
1986  p "Date:              &today";
1987  p "Project Root: &root";
1988  p "Script:            &file";
1989  p "Log File:         &log";
1990  p "Results File:  &pdf";
1991  RUN;
NOTE: PROCEDURE ODSTEXT used (Total process time):
      real time           0.02 seconds
      cpu time            0.00 seconds
      

1992  
1993  /*https://blogs.sas.com/content/iml/2020/02/17/visualize-collinearity-diagnostics.
1993! html*/
1994  
1995  * find collinearity;
1996  * for reg have to convert char to numeric: vars race, sex, budget_grp_new;
1997  
1998  /*PROC CORR Data =  data.dat_reg_pc_cost outp=pc_cost_corr;*/
1999  /*VAR int int_imp time age sex_numeric race_numeric*/
2000  /*                         budget_group*/
2001  /*                         rae_person_new  fqhc*/
2002  /*                         bh_2016 bh_2017 bh_2018*/
2003  /*                         adj_pd_total_16cat */
2004  /*                         adj_pd_total_17cat */
2005  /*                         adj_pd_total_18cat;*/
2006  /*RUN; */
2007  /**/
2008  /*DATA pc_cost_corr_ge70 (drop=i);*/
2009  /*set  pc_cost_corr (where=(_TYPE_ in ("CORR")));*/
2010  /*array col(*) int--adj_pd_total_18cat;*/
2011  /*do i=1 to dim(col);*/
2012  /*if (col{i}<0.6 AND col{i}>-.6) OR col{i}=1 then col{i}=.; */
2013  /*end; */
2014  /*RUN; */
2015  /**/
2016  /*%let keep_vars = _type_ _name_ int int_imp age budget_group; */
2017  /*DATA pc_cost_corr_print ;*/
2018  /*SET  pc_cost_corr_ge70 (keep = &keep_vars);*/
2019  /*RUN; */
2020  /**/
2021  /*PROC PRINT DATA = pc_cost_corr_print; */
2022  /*RUN; */
2023  
2024  * model 1;
2025  %let regvars = int int_imp time
2026                  season1     season2     season3
2027                  age_cat_num     sex_numeric race_numeric
2028                  budget_group
2029                  rae_person_new      fqhc
2030                  bh_2016     bh_2017     bh_2018
2031                  adj_pd_total_16cat
2032                  adj_pd_total_17cat
2033                  adj_pd_total_18cat;
2034  
2035  PROC REG DATA = data.analysis_numeric;
2036  MODEL ind_pc_cost = &regvars / tol vif collin covb;
2037  ods select ParameterEstimates CollinDiag;
2038  ods output CollinDiag = Collin;
2039  RUN ;

WARNING: ODS graphics with more than 5000 points have been suppressed. Use the 
         PLOTS(MAXPOINTS= ) option in the PROC REG statement to change or override the 
         cutoff.
2039!        Quit;
NOTE: The data set WORK.COLLIN has 19 observations and 24 variables.

NOTE: PROCEDURE REG used (Total process time):
      real time           39.95 seconds
      cpu time            11.18 seconds
      

2040  
2041  proc format;
2042  value CollinFmt
2043    0.0 -<  0.4  = "PropLow"
2044    0.4 -<  0.5  = "PropMed"
2045    0.5 -<  1.0  = "PropHigh"
2046    1.0 -<  20   = "CondLow"
2047     20 -<  30   = "CondMed"
2048     30 -< 100   = "CondHigh"
2049     other       = "CondExtreme";
NOTE: Format COLLINFMT is already on the library WORK.FORMATS.
NOTE: Format COLLINFMT has been output.
2050  run;

NOTE: PROCEDURE FORMAT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

2051  
2052  data CollinLong;
2053  length VarName $32 TextVal $5;
2054  set collin(drop=Model Dependent Eigenvalue);
2055  array v[*] _numeric_;
2056  do j = 2 to dim(v);
2057     VarName = vname(v[j]);
2058     Val = v[j];
2059     if j=2 then TextVal = put(Val, 5.0);
2060     else do;
2061        if Val<0.4 then TextVal = ' ';
2062        else TextVal = put(100*Val, 2.0); *convert proportion to pct;
2063     end;
2064     output;
2065  end;
2066  keep Number VarName Val TextVal;
2067  run;

NOTE: There were 19 observations read from the data set WORK.COLLIN.
NOTE: The data set WORK.COLLINLONG has 380 observations and 4 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds
      

2068  
2069  /*Title "Collinearity Diagnostics Long";*/
2070  /*proc print data = collinlong ; */
2071  /*run ; */
2072  /*title; */
2073  
2074  /* create a discrete attribute map:
2075     https://blogs.sas.com/content/iml/2019/07/15/create-discrete-heat-map-sgplot.ht
2075! ml
2076  */
2077  data Order;                            /* create discrete attribute map */
2078  length Value $15 FillColor $15;
2079  input raw FillColor;
2080  Value = put(raw, CollinFmt.);          /* use format to assign values */
2081  retain ID 'SortOrder'                  /* name of map */
2082       Show 'AttrMap';                   /* always show all groups in legend */
2083  datalines;

NOTE: The data set WORK.ORDER has 7 observations and 5 variables.
NOTE: DATA statement used (Total process time):
      real time           0.04 seconds
      cpu time            0.01 seconds
      

2091  ;
2092  
2093  /* Create a discrete heat map and overlay text for the condition numbers
2094     and the important (high) cells of the proportion of variance. */
2095  title "Collinearity Diagnostics";
2096  proc sgplot data=CollinLong dattrmap=Order noautolegend;
2097    format Val CollinFmt.;
2098    heatmapparm x=VarName y=Number colorgroup=Val / outline
2099                attrid=SortOrder nomissingcolor discretey;
2100    text x=VarName y=Number text=TextVal / strip textattrs=(size=14);
2101    refline "ConditionIndex" / axis=x lineattrs=(color=DarkGray)
2102            discreteoffset=0.5 discretethickness=0.08;
2103    xaxis display=(nolabel);
2104  run;

NOTE: STATGRAPH 'SGPlot' has been saved to: WORK.___Graph___
NOTE: PROCEDURE SGPLOT used (Total process time):
      real time           0.75 seconds
      cpu time            0.34 seconds
      
NOTE: There were 380 observations read from the data set WORK.COLLINLONG.
NOTE: There were 7 observations read from the data set WORK.ORDER.

2105  
2106  proc printto; run;

